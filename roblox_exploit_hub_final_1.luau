--!strict

--[[ Configuration ]]
local Config = {
    Theme = {
        Primary = Color3.fromRGB(255, 117, 24), -- #FF7518 Orange
        Accent = Color3.fromRGB(204, 82, 0),    -- #CC5200 Dark Orange
        Background = Color3.fromRGB(0, 0, 0),  -- #000000 Black
        Text = Color3.fromRGB(255, 255, 255),  -- #FFFFFF White
        ButtonBorder = Color3.fromRGB(0, 0, 0) -- Black for button borders
    },
    GUI = {
        InitialSize = UDim2.new(0, 500, 0, 350), -- Initial size of the main GUI window
        MinimizedSize = UDim2.new(0, 50, 0, 50), -- Size when minimized
        MinimizedPosition = UDim2.new(1, -60, 1, -60), -- Bottom-right corner
        AnimationSpeed = 0.2 -- Seconds for smooth transitions
    }
}

--[[ Services ]]
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")

--[[ Main GUI Setup ]]
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ExploitHub"
ScreenGui.DisplayOrder = 999 -- Ensure it's on top
ScreenGui.Parent = PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = Config.GUI.InitialSize
MainFrame.Position = UDim2.new(0.5, -MainFrame.Size.X.Offset / 2, 0.5, -MainFrame.Size.Y.Offset / 2) -- Center of screen
MainFrame.BackgroundColor3 = Config.Theme.Background
MainFrame.BorderSizePixel = 0
MainFrame.Active = true -- Important for dragging
MainFrame.Draggable = false -- Custom draggable logic
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

--[[ Title Bar ]]
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Config.Theme.Primary
TitleBar.BorderSizePixel = 0
TitleBar.Active = true
TitleBar.Draggable = false -- Custom draggable logic
TitleBar.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, -60, 1, 0)
TitleLabel.Position = UDim2.new(0, 0, 0, 0)
TitleLabel.BackgroundColor3 = Config.Theme.Primary
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Exploit Hub"
TitleLabel.TextColor3 = Config.Theme.Text
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 20
TitleLabel.TextScaled = false
TitleLabel.Parent = TitleBar

--[[ Minimize Button ]]
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 1, 0)
MinimizeButton.Position = UDim2.new(1, -30, 0, 0)
MinimizeButton.BackgroundColor3 = Config.Theme.Accent
MinimizeButton.BorderSizePixel = 1
MinimizeButton.BorderColor3 = Config.Theme.ButtonBorder
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Config.Theme.Text
MinimizeButton.Font = Enum.Font.SourceSansBold
MinimizeButton.TextSize = 20
MinimizeButton.Parent = TitleBar

--[[ Close Button (Toggle Full GUI) ]]
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 1, 0)
CloseButton.Position = UDim2.new(1, -60, 0, 0)
CloseButton.BackgroundColor3 = Config.Theme.Accent
CloseButton.BorderSizePixel = 1
CloseButton.BorderColor3 = Config.Theme.ButtonBorder
CloseButton.Text = "X"
CloseButton.TextColor3 = Config.Theme.Text
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextSize = 20
CloseButton.Parent = TitleBar

--[[ Minimized GUI (Small square icon) ]]
local MinimizedFrame = Instance.new("TextButton")
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Size = Config.GUI.MinimizedSize
MinimizedFrame.Position = Config.GUI.MinimizedPosition
MinimizedFrame.BackgroundColor3 = Config.Theme.Primary
MinimizedFrame.BorderSizePixel = 1
MinimizedFrame.BorderColor3 = Config.Theme.ButtonBorder
MinimizedFrame.Text = "Hub"
MinimizedFrame.TextColor3 = Config.Theme.Text
MinimizedFrame.Font = Enum.Font.SourceSansBold
MinimizedFrame.TextSize = 16
MinimizedFrame.Visible = false -- Initially hidden
MinimizedFrame.Parent = ScreenGui

--[[ Draggable Logic ]]
local isDragging = false
local dragStart = Vector2.new(0, 0)
local startPosition = UDim2.new(0, 0, 0, 0)

local function startDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
        dragStart = input.Position
        startPosition = MainFrame.Position
    end
end

local function doDrag(input)
    if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        local newX = startPosition.X.Offset + delta.X
        local newY = startPosition.Y.Offset + delta.Y
        MainFrame.Position = UDim2.new(0, newX, 0, newY)
    end
end

local function endDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = false
    end
end

TitleBar.InputBegan:Connect(startDrag)
UserInputService.InputChanged:Connect(doDrag)
UserInputService.InputEnded:Connect(endDrag)

--[[ Minimize/Maximize Logic ]]
local isMinimized = false

local function toggleMinimize()
    isMinimized = not isMinimized

    if isMinimized then
        -- Minimize animation
        local tweenInfo = TweenInfo.new(Config.GUI.AnimationSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goal = {Size = Config.GUI.MinimizedSize, Position = Config.GUI.MinimizedPosition}
        local tween = TweenService:Create(MainFrame, tweenInfo, goal)
        tween:Play()
        tween.Completed:Wait()
        MainFrame.Visible = false
        MinimizedFrame.Visible = true
    else
        -- Maximize animation
        MainFrame.Visible = true
        MinimizedFrame.Visible = false
        local tweenInfo = TweenInfo.new(Config.GUI.AnimationSpeed, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goal = {Size = Config.GUI.InitialSize, Position = UDim2.new(0.5, -Config.GUI.InitialSize.X.Offset / 2, 0.5, -Config.GUI.InitialSize.Y.Offset / 2)}
        local tween = TweenService:Create(MainFrame, tweenInfo, goal)
        tween:Play()
    end
end

MinimizeButton.MouseButton1Click:Connect(toggleMinimize)
MinimizedFrame.MouseButton1Click:Connect(toggleMinimize)

--[[ Toggle Full GUI (Close Button) ]]
local function toggleFullGUI()
    MainFrame.Visible = not MainFrame.Visible
    if not MainFrame.Visible then
        MinimizedFrame.Visible = false -- Ensure minimized frame is also hidden if full GUI is closed
    end
end

CloseButton.MouseButton1Click:Connect(toggleFullGUI)

--[[ Resizable Logic (Basic, needs refinement for mobile touch) ]]
local isResizing = false
local resizeStart = Vector2.new(0, 0)
local startSize = UDim2.new(0, 0, 0, 0)

local ResizeHandle = Instance.new("Frame")
ResizeHandle.Name = "ResizeHandle"
ResizeHandle.Size = UDim2.new(0, 10, 0, 10)
ResizeHandle.Position = UDim2.new(1, -10, 1, -10)
ResizeHandle.BackgroundColor3 = Config.Theme.Accent
ResizeHandle.BorderSizePixel = 0
ResizeHandle.Active = true
ResizeHandle.Parent = MainFrame

ResizeHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isResizing = true
        resizeStart = input.Position
        startSize = MainFrame.Size
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isResizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - resizeStart
        local newX = math.max(200, startSize.X.Offset + delta.X) -- Minimum width of 200
        local newY = math.max(150, startSize.Y.Offset + delta.Y) -- Minimum height of 150
        MainFrame.Size = UDim2.new(0, newX, 0, newY)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isResizing = false
    end
end)

--[[ Tab System ]]
local TabContainer = Instance.new("Frame")
TabContainer.Name = "TabContainer"
TabContainer.Size = UDim2.new(0, 120, 1, -30) -- Width for tabs, height adjusted for title bar
TabContainer.Position = UDim2.new(0, 0, 0, 30)
TabContainer.BackgroundColor3 = Config.Theme.Accent
TabContainer.BorderSizePixel = 0
TabContainer.Parent = MainFrame

local TabContentContainer = Instance.new("Frame")
TabContentContainer.Name = "TabContentContainer"
TabContentContainer.Size = UDim2.new(1, -120, 1, -30) -- Remaining width for content
TabContentContainer.Position = UDim2.new(0, 120, 0, 30)
TabContentContainer.BackgroundColor3 = Config.Theme.Background
TabContentContainer.BorderSizePixel = 0
TabContentContainer.Parent = MainFrame

local TabButtons = {}
local TabContents = {}
local ActiveTab = nil

local function createTab(name, contentFrame)
    local button = Instance.new("TextButton")
    button.Name = name .. "TabButton"
    button.Size = UDim2.new(1, 0, 0, 40)
    button.BackgroundColor3 = Config.Theme.Accent
    button.BorderSizePixel = 0
    button.Text = name
    button.TextColor3 = Config.Theme.Text
    button.Font = Enum.Font.SourceSansSemibold
    button.TextSize = 16
    button.Parent = TabContainer

    contentFrame.Name = name .. "TabContent"
    contentFrame.Size = UDim2.new(1, 0, 1, 0)
    contentFrame.Position = UDim2.new(0, 0, 0, 0)
    contentFrame.BackgroundColor3 = Config.Theme.Background
    contentFrame.BorderSizePixel = 0
    contentFrame.Visible = false
    contentFrame.Parent = TabContentContainer

    TabButtons[name] = button
    TabContents[name] = contentFrame

    button.MouseButton1Click:Connect(function()
        if ActiveTab then
            TabButtons[ActiveTab].BackgroundColor3 = Config.Theme.Accent
            TabContents[ActiveTab].Visible = false
        end
        ActiveTab = name
        button.BackgroundColor3 = Config.Theme.Primary
        contentFrame.Visible = true
    end)

    return contentFrame
end

--[[ UI Element Creation Helpers ]]
local function createSection(parent, title)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 0, 25)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundColor3 = Config.Theme.Background
    label.BackgroundTransparency = 1
    label.Text = title
    label.TextColor3 = Config.Theme.Primary
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 18
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent
    return label
end

local function createToggle(parent, text, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 30)
    frame.Position = UDim2.new(0, 10, 0, 0)
    frame.BackgroundColor3 = Config.Theme.Background
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundColor3 = Config.Theme.Background
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Config.Theme.Text
    label.Font = Enum.Font.SourceSansSemibold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.25, 0, 1, 0)
    button.Position = UDim2.new(0.75, 0, 0, 0)
    button.BackgroundColor3 = Config.Theme.Accent
    button.BorderSizePixel = 1
    button.BorderColor3 = Config.Theme.ButtonBorder
    button.Text = "OFF"
    button.TextColor3 = Config.Theme.Text
    button.Font = Enum.Font.SourceSansBold
    button.TextSize = 14
    button.Parent = frame

    local active = false
    button.MouseButton1Click:Connect(function()
        active = not active
        button.Text = active and "ON" or "OFF"
        button.BackgroundColor3 = active and Config.Theme.Primary or Config.Theme.Accent
        callback(active)
    end)
    return frame
end

local function createTextbox(parent, text, defaultValue, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 30)
    frame.Position = UDim2.new(0, 10, 0, 0)
    frame.BackgroundColor3 = Config.Theme.Background
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundColor3 = Config.Theme.Background
    label.BackgroundTransparency = 1
    label.Text = text .. ":"
    label.TextColor3 = Config.Theme.Text
    label.Font = Enum.Font.SourceSansSemibold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local textbox = Instance.new("TextBox")
    textbox.Size = UDim2.new(0.45, 0, 1, 0)
    textbox.Position = UDim2.new(0.55, 0, 0, 0)
    textbox.BackgroundColor3 = Config.Theme.Accent
    textbox.BorderSizePixel = 1
    textbox.BorderColor3 = Config.Theme.ButtonBorder
    textbox.Text = tostring(defaultValue)
    textbox.TextColor3 = Config.Theme.Text
    textbox.Font = Enum.Font.SourceSansSemibold
    textbox.TextSize = 14
    textbox.TextXAlignment = Enum.TextXAlignment.Left
    textbox.Parent = frame

    textbox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            callback(textbox.Text)
        end
    end)
    return frame
end

local function createDropdown(parent, text, options, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 30)
    frame.Position = UDim2.new(0, 10, 0, 0)
    frame.BackgroundColor3 = Config.Theme.Background
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundColor3 = Config.Theme.Background
    label.BackgroundTransparency = 1
    label.Text = text .. ":"
    label.TextColor3 = Config.Theme.Text
    label.Font = Enum.Font.SourceSansSemibold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Size = UDim2.new(0.45, 0, 1, 0)
    dropdownButton.Position = UDim2.new(0.55, 0, 0, 0)
    dropdownButton.BackgroundColor3 = Config.Theme.Accent
    dropdownButton.BorderSizePixel = 1
    dropdownButton.BorderColor3 = Config.Theme.ButtonBorder
    dropdownButton.Text = options[1] or "Select"
    dropdownButton.TextColor3 = Config.Theme.Text
    dropdownButton.Font = Enum.Font.SourceSansSemibold
    dropdownButton.TextSize = 14
    dropdownButton.Parent = frame

    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0.45, 0, 0, math.min(200, #options * 20)) -- Max height 200, or options * 20
    dropdownFrame.Position = UDim2.new(0.55, 0, 1, 0)
    dropdownFrame.BackgroundColor3 = Config.Theme.Accent
    dropdownFrame.BorderSizePixel = 1
    dropdownFrame.BorderColor3 = Config.Theme.ButtonBorder
    dropdownFrame.Visible = false
    dropdownFrame.ZIndex = 2 -- Ensure dropdown is on top
    dropdownFrame.Parent = frame

    local dropdownLayout = Instance.new("UIListLayout")
    dropdownLayout.FillDirection = Enum.FillDirection.Vertical
    dropdownLayout.Parent = dropdownFrame

    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Size = UDim2.new(1, 0, 0, 20)
        optionButton.BackgroundColor3 = Config.Theme.Accent
        optionButton.BackgroundTransparency = 0.5
        optionButton.BorderSizePixel = 0
        optionButton.Text = option
        optionButton.TextColor3 = Config.Theme.Text
        optionButton.Font = Enum.Font.SourceSansSemibold
        optionButton.TextSize = 12
        optionButton.Parent = dropdownFrame

        optionButton.MouseButton1Click:Connect(function()
            dropdownButton.Text = option
            dropdownFrame.Visible = false
            callback(option)
        end)
    end

    dropdownButton.MouseButton1Click:Connect(function()
        dropdownFrame.Visible = not dropdownFrame.Visible
    end)
    return frame
end

local function createButton(parent, text, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 30)
    button.Position = UDim2.new(0, 10, 0, 0)
    button.BackgroundColor3 = Config.Theme.Primary
    button.BorderSizePixel = 1
    button.BorderColor3 = Config.Theme.ButtonBorder
    button.Text = text
    button.TextColor3 = Config.Theme.Text
    button.Font = Enum.Font.SourceSansBold
    button.TextSize = 16
    button.Parent = parent

    button.MouseButton1Click:Connect(callback)
    return button
end

--[[ Main Tab ]]
local MainTabContent = createTab("Main", Instance.new("ScrollingFrame"))
local MainTabFeaturesLayout = Instance.new("UIListLayout")
MainTabFeaturesLayout.FillDirection = Enum.FillDirection.Vertical
MainTabFeaturesLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
MainTabFeaturesLayout.VerticalAlignment = Enum.VerticalAlignment.Top
MainTabFeaturesLayout.Padding = UDim.new(0, 5)
MainTabFeaturesLayout.Parent = MainTabContent

-- 1. ESP (Boxes, Names, Health, Distance, Tracers, customizable colors).
local espEnabled = false
local espDrawingObjects = {}
local espConnections = {}

local function createESPDrawing(character)
    local drawings = {}
    drawings.Box = Instance.new("BoxHandleAdornment")
    drawings.Box.Adornee = character
    drawings.Box.AlwaysOnTop = true
    drawings.Box.Color3 = Config.Theme.Primary
    drawings.Box.Transparency = 0.5
    drawings.Box.Visible = false
    drawings.Box.Parent = ScreenGui

    drawings.Name = Instance.new("TextLabel")
    drawings.Name.BackgroundTransparency = 1
    drawings.Name.TextColor3 = Config.Theme.Text
    drawings.Name.TextScaled = true
    drawings.Name.Size = UDim2.new(0, 100, 0, 20)
    drawings.Name.Font = Enum.Font.SourceSansBold
    drawings.Name.Visible = false
    drawings.Name.Parent = ScreenGui

    drawings.Health = Instance.new("TextLabel")
    drawings.Health.BackgroundTransparency = 1
    drawings.Health.TextColor3 = Color3.fromRGB(0, 255, 0)
    drawings.Health.TextScaled = true
    drawings.Health.Size = UDim2.new(0, 100, 0, 20)
    drawings.Health.Font = Enum.Font.SourceSansBold
    drawings.Health.Visible = false
    drawings.Health.Parent = ScreenGui

    drawings.Distance = Instance.new("TextLabel")
    drawings.Distance.BackgroundTransparency = 1
    drawings.Distance.TextColor3 = Config.Theme.Text
    drawings.Distance.TextScaled = true
    drawings.Distance.Size = UDim2.new(0, 100, 0, 20)
    drawings.Distance.Font = Enum.Font.SourceSansBold
    drawings.Distance.Visible = false
    drawings.Distance.Parent = ScreenGui

    -- Tracers (Line from player to target)
    drawings.Tracer = Instance.new("LineHandleAdornment")
    drawings.Tracer.Adornee = character
    drawings.Tracer.AlwaysOnTop = true
    drawings.Tracer.Color3 = Config.Theme.Accent
    drawings.Tracer.Thickness = 2
    drawings.Tracer.Visible = false
    drawings.Tracer.Parent = ScreenGui

    return drawings
end

local function updateESP(character)
    if not character or not character:FindFirstChildOfClass("Humanoid") or character:FindFirstChildOfClass("Humanoid").Health <= 0 then
        if espDrawingObjects[character] then
            for _, drawing in pairs(espDrawingObjects[character]) do
                drawing:Destroy()
            end
            espDrawingObjects[character] = nil
        end
        return
    end

    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end

    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    local camera = Workspace.CurrentCamera
    local screenPoint, onScreen = camera:WorldToScreenPoint(rootPart.Position)

    if onScreen then
        if not espDrawingObjects[character] then
            espDrawingObjects[character] = createESPDrawing(character)
        end

        local headPosition = character:FindFirstChild("Head") and character.Head.Position or rootPart.Position
        local footPosition = rootPart.Position - Vector3.new(0, character.Humanoid.HipHeight, 0)

        local screenHead, onScreenHead = camera:WorldToScreenPoint(headPosition + Vector3.new(0, 0.5, 0))
        local screenFoot, onScreenFoot = camera:WorldToScreenPoint(footPosition - Vector3.new(0, 0.5, 0))

        if not onScreenHead and not onScreenFoot then
            for _, drawing in pairs(espDrawingObjects[character]) do
                drawing.Visible = false
            end
            return
        end

        local boxHeight = math.abs(screenHead.Y - screenFoot.Y)
        local boxWidth = boxHeight / 2
        local boxPosition = Vector2.new(screenHead.X - boxWidth / 2, screenHead.Y)

        -- Update Box
        espDrawingObjects[character].Box.Visible = true
        espDrawingObjects[character].Box.Position = rootPart.Position
        espDrawingObjects[character].Box.Size = Vector3.new(1, humanoid.HipHeight * 2, 1)

        -- Update Name
        espDrawingObjects[character].Name.Visible = true
        espDrawingObjects[character].Name.Position = UDim2.new(0, boxPosition.X, 0, boxPosition.Y - 20)
        espDrawingObjects[character].Name.Text = character.Name

        -- Update Health
        espDrawingObjects[character].Health.Visible = true
        espDrawingObjects[character].Health.Position = UDim2.new(0, boxPosition.X, 0, boxPosition.Y + boxHeight + 5)
        espDrawingObjects[character].Health.Text = "HP: " .. math.floor(humanoid.Health) .. "/" .. math.floor(humanoid.MaxHealth)

        -- Update Distance
        local distance = (Player.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
        espDrawingObjects[character].Distance.Visible = true
        espDrawingObjects[character].Distance.Position = UDim2.new(0, boxPosition.X, 0, boxPosition.Y + boxHeight + 20)
        espDrawingObjects[character].Distance.Text = "Dist: " .. math.floor(distance) .. "m"

        -- Update Tracer
        espDrawingObjects[character].Tracer.Visible = true
        espDrawingObjects[character].Tracer.CFrame = CFrame.new(Player.Character.HumanoidRootPart.Position, rootPart.Position)
        espDrawingObjects[character].Tracer.From = Player.Character.HumanoidRootPart.Position
        espDrawingObjects[character].Tracer.To = rootPart.Position

    else
        if espDrawingObjects[character] then
            for _, drawing in pairs(espDrawingObjects[character]) do
                drawing.Visible = false
            end
        end
    end
end

local function disableESP()
    for char, drawings in pairs(espDrawingObjects) do
        for _, drawing in pairs(drawings) do
            drawing:Destroy()
        end
    end
    espDrawingObjects = {}
    for _, conn in pairs(espConnections) do
        conn:Disconnect()
    end
    espConnections = {}
end

local function enableESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character then
            updateESP(player.Character)
            espConnections[player] = player.Character.DescendantAdded:Connect(function(descendant)
                if descendant:IsA("HumanoidRootPart") then
                    updateESP(player.Character)
                end
            end)
            espConnections[player .. "_removed"] = player.Character.AncestryChanged:Connect(function(_, parent)
                if not parent then -- Character removed
                    if espDrawingObjects[player.Character] then
                        for _, drawing in pairs(espDrawingObjects[player.Character]) do
                            drawing:Destroy()
                        end
                        espDrawingObjects[player.Character] = nil
                    end
                end
            end)
        end
    end
    espConnections["playerAdded"] = Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function(char)
            if espEnabled then
                updateESP(char)
            end
        end)
    end)
    espConnections["playerRemoving"] = Players.PlayerRemoving:Connect(function(player)
        if espDrawingObjects[player.Character] then
            for _, drawing in pairs(espDrawingObjects[player.Character]) do
                drawing:Destroy()
            end
            espDrawingObjects[player.Character] = nil
        end
    end)
    espConnections["renderStepped"] = RunService.RenderStepped:Connect(function()
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Player and player.Character then
                updateESP(player.Character)
            end
        end
    end)
end

createToggle(MainTabContent, "ESP", function(active)
    espEnabled = active
    if active then
        enableESP()
    else
        disableESP()
    end
end)

-- 2. Aimbot (Lock to head/body/random parts via dropdown, adjustable FOV via textbox, smooth prediction, no misses or errors).
local aimbotEnabled = false
local aimbotTargetPart = "Head"
local aimbotFOV = 90
local aimbotConnection = nil

local function findTarget()
    local closestTarget = nil
    local minDistance = math.huge
    local camera = Workspace.CurrentCamera
    local localPlayerRoot = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localPlayerRoot then return nil end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChildOfClass("Humanoid") and player.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
            local targetRoot = player.Character.HumanoidRootPart
            local targetPosition = targetRoot.Position
            local distance = (localPlayerRoot.Position - targetPosition).Magnitude

            local screenPoint, onScreen = camera:WorldToScreenPoint(targetPosition)
            if onScreen then
                local viewportSize = camera.ViewportSize
                local center = Vector2.new(viewportSize.X / 2, viewportSize.Y / 2)
                local fovDistance = (Vector2.new(screenPoint.X, screenPoint.Y) - center).Magnitude

                if fovDistance <= aimbotFOV and distance < minDistance then
                    minDistance = distance
                    closestTarget = player.Character
                end
            end
        end
    end
    return closestTarget
end

local function doAimbot()
    local target = findTarget()
    if target and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local targetPart = target:FindFirstChild(aimbotTargetPart) or target.HumanoidRootPart
        if targetPart then
            local origin = Player.Character.HumanoidRootPart.CFrame.p
            local direction = (targetPart.Position - origin).Unit
            local lookAt = CFrame.new(origin, origin + direction)
            Workspace.CurrentCamera.CFrame = TweenService:Create(Workspace.CurrentCamera, TweenInfo.new(0.1), {CFrame = lookAt}):Play()
        end
    end
end

createToggle(MainTabContent, "Aimbot", function(active)
    aimbotEnabled = active
    if active then
        aimbotConnection = RunService.RenderStepped:Connect(doAimbot)
    else
        if aimbotConnection then
            aimbotConnection:Disconnect()
            aimbotConnection = nil
        end
    end
end)

createDropdown(MainTabContent, "Aimbot Part", {"Head", "HumanoidRootPart"}, function(selection)
    aimbotTargetPart = selection
end)

createTextbox(MainTabContent, "Aimbot FOV", aimbotFOV, function(value)
    aimbotFOV = tonumber(value) or aimbotFOV
end)

-- 3. WalkSpeed
local walkSpeedValue = 16
createTextbox(MainTabContent, "WalkSpeed", walkSpeedValue, function(value)
    walkSpeedValue = tonumber(value) or 16
    if Player.Character and Player.Character:FindFirstChildOfClass("Humanoid") then
        Player.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = walkSpeedValue
    end
end)

-- 4. JumpPower
local jumpPowerValue = 50
createTextbox(MainTabContent, "JumpPower", jumpPowerValue, function(value)
    jumpPowerValue = tonumber(value) or 50
    if Player.Character and Player.Character:FindFirstChildOfClass("Humanoid") then
        Player.Character:FindFirstChildOfClass("Humanoid").JumpPower = jumpPowerValue
    end
end)

-- 5. Infinite Jump
local infiniteJumpEnabled = false
local infiniteJumpConnection = nil

local function doInfiniteJump()
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) and Player.Character and Player.Character:FindFirstChildOfClass("Humanoid") then
        Player.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
    end
end

createToggle(MainTabContent, "Infinite Jump", function(active)
    infiniteJumpEnabled = active
    if active then
        infiniteJumpConnection = RunService.RenderStepped:Connect(doInfiniteJump)
    else
        if infiniteJumpConnection then
            infiniteJumpConnection:Disconnect()
            infiniteJumpConnection = nil
        end
    end
end)

-- 6. Noclip
local noclipEnabled = false
local noclipConnection = nil

local function toggleNoclip(active)
    noclipEnabled = active
    if Player.Character then
        for _, part in ipairs(Player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = not active
            end
        end
    end
end

createToggle(MainTabContent, "Noclip", function(active)
    toggleNoclip(active)
    if active then
        noclipConnection = Player.CharacterAdded:Connect(function(char)
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
    end
end)

-- 7. Teleport to Player
local function teleportToPlayer(targetPlayerName)
    local targetPlayer = Players:FindFirstChild(targetPlayerName)
    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        Player.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0)
    end
end

local playerNames = {}
for _, p in ipairs(Players:GetPlayers()) do
    table.insert(playerNames, p.Name)
end

createDropdown(MainTabContent, "Teleport to Player", playerNames, function(selection)
    teleportToPlayer(selection)
end)

-- 8. Auto Clicker
local autoClickerEnabled = false
local autoClickerCPS = 10
local autoClickerConnection = nil

local function doAutoClick()
    if autoClickerEnabled then
        UserInputService:SimulateMouseClick(Enum.UserInputType.MouseButton1)
    end
end

createToggle(MainTabContent, "Auto Clicker", function(active)
    autoClickerEnabled = active
    if active then
        autoClickerConnection = RunService.Heartbeat:Connect(function()
            task.wait(1 / autoClickerCPS)
            doAutoClick()
        end)
    else
        if autoClickerConnection then
            autoClickerConnection:Disconnect()
            autoClickerConnection = nil
        end
    end
end)

createTextbox(MainTabContent, "Auto Clicker CPS", autoClickerCPS, function(value)
    autoClickerCPS = tonumber(value) or autoClickerCPS
end)

-- 9. Reach Extender
local reachExtenderEnabled = false
local reachDistance = 20
local reachExtenderConnection = nil

local function doReachExtender()
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end

    local mouse = Player:GetMouse()
    local target = mouse.Target
    if target and target.Parent and target.Parent:FindFirstChildOfClass("Humanoid") then
        local targetHumanoid = target.Parent:FindFirstChildOfClass("Humanoid")
        if targetHumanoid and (rootPart.Position - target.Position).Magnitude <= reachDistance then
            targetHumanoid:TakeDamage(1) -- Basic damage, can be improved
        end
    end
end

createToggle(MainTabContent, "Reach Extender", function(active)
    reachExtenderEnabled = active
    if active then
        reachExtenderConnection = RunService.Heartbeat:Connect(doReachExtender)
    else
        if reachExtenderConnection then
            reachExtenderConnection:Disconnect()
            reachExtenderConnection = nil
        end
    end
end)

createTextbox(MainTabContent, "Reach Distance", reachDistance, function(value)
    reachDistance = tonumber(value) or reachDistance
end)

-- 10. Hitbox Expander
local hitboxExpanderEnabled = false
local hitboxSize = 5
local hitboxExpanderConnection = nil

local function doHitboxExpander()
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end

    local hitbox = rootPart:FindFirstChild("Hitbox")
    if not hitbox then
        hitbox = Instance.new("Part")
        hitbox.Name = "Hitbox"
        hitbox.Transparency = 1
        hitbox.CanCollide = false
        hitbox.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
        hitbox.Parent = rootPart
        local weld = Instance.new("Weld")
        weld.Part0 = rootPart
        weld.Part1 = hitbox
        weld.Parent = hitbox
    else
        hitbox.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
    end
end

createToggle(MainTabContent, "Hitbox Expander", function(active)
    hitboxExpanderEnabled = active
    if active then
        doHitboxExpander()
        hitboxExpanderConnection = RunService.Heartbeat:Connect(doHitboxExpander)
    else
        if hitboxExpanderConnection then
            hitboxExpanderConnection:Disconnect()
            hitboxExpanderConnection = nil
        end
        if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local hitbox = Player.Character.HumanoidRootPart:FindFirstChild("Hitbox")
            if hitbox then
                hitbox:Destroy()
            end
        end
    end
end)

createTextbox(MainTabContent, "Hitbox Size", hitboxSize, function(value)
    hitboxSize = tonumber(value) or hitboxSize
    if hitboxExpanderEnabled then
        doHitboxExpander()
    end
end)

-- 11. Anti-Lock (Toggle to counter aimbots).
local antiLockEnabled = false
local antiLockConnection = nil

local function doAntiLock()
    local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.AutoRotate = false -- Prevents automatic rotation from external forces
    end
end

createToggle(MainTabContent, "Anti-Lock", function(active)
    antiLockEnabled = active
    if active then
        antiLockConnection = RunService.Heartbeat:Connect(doAntiLock)
    else
        if antiLockConnection then
            antiLockConnection:Disconnect()
            antiLockConnection = nil
        end
        local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.AutoRotate = true
        end
    end
end)

-- 12. Triggerbot (Toggle for auto-shoot on crosshair).
local triggerbotEnabled = false
local triggerbotConnection = nil

local function doTriggerbot()
    local mouse = Player:GetMouse()
    local target = mouse.Target
    if target and target.Parent and target.Parent:FindFirstChildOfClass("Humanoid") and target.Parent ~= Player.Character then
        UserInputService:SimulateMouseClick(Enum.UserInputType.MouseButton1)
    end
end

createToggle(MainTabContent, "Triggerbot", function(active)
    triggerbotEnabled = active
    if active then
        triggerbotConnection = RunService.Heartbeat:Connect(doTriggerbot)
    else
        if triggerbotConnection then
            triggerbotConnection:Disconnect()
            triggerbotConnection = nil
        end
    end
end)

-- 13. Silent Aim (Toggle, with FOV).
local silentAimEnabled = false
local silentAimFOV = 90
local silentAimConnection = nil

local function doSilentAim()
    local target = findTarget() -- Reusing aimbot's findTarget
    if target and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        local targetPart = target:FindFirstChild(aimbotTargetPart) or target.HumanoidRootPart -- Reusing aimbotTargetPart
        if targetPart then
            -- This is a simplified silent aim. True silent aim requires more advanced packet manipulation
            -- or client-sided bullet prediction, which is beyond the scope of a basic Luau script.
            -- For demonstration, we'll just aim the camera very quickly.
            local origin = Player.Character.HumanoidRootPart.CFrame.p
            local direction = (targetPart.Position - origin).Unit
            local lookAt = CFrame.new(origin, origin + direction)
            Workspace.CurrentCamera.CFrame = lookAt
        end
    end
end

createToggle(MainTabContent, "Silent Aim", function(active)
    silentAimEnabled = active
    if active then
        silentAimConnection = RunService.RenderStepped:Connect(doSilentAim)
    else
        if silentAimConnection then
            silentAimConnection:Disconnect()
            silentAimConnection = nil
        end
    end
end)

createTextbox(MainTabContent, "Silent Aim FOV", silentAimFOV, function(value)
    silentAimFOV = tonumber(value) or silentAimFOV
end)

-- 14. Wallbang (Toggle for shooting through walls if game allows).
-- This feature is highly game-dependent and often server-sided. A client-sided toggle is mostly a placeholder.
createToggle(MainTabContent, "Wallbang (Game Dependent)", function(active)
    warn("Wallbang functionality is highly dependent on the game's server-side logic.")
end)

-- 15. Item ESP (For collectibles/NPCs).
local itemEspEnabled = false
local itemEspDrawingObjects = {}
local itemEspConnections = {}

local function createItemESPDrawing(instance)
    local textLabel = Instance.new("TextLabel")
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Config.Theme.Accent
    textLabel.TextScaled = true
    textLabel.Size = UDim2.new(0, 100, 0, 20)
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.Visible = false
    textLabel.Parent = ScreenGui
    return textLabel
end

local function updateItemESP(instance)
    if not instance or not instance:IsA("BasePart") or not instance.Parent then return end
    local camera = Workspace.CurrentCamera
    local screenPoint, onScreen = camera:WorldToScreenPoint(instance.Position)

    if onScreen then
        if not itemEspDrawingObjects[instance] then
            itemEspDrawingObjects[instance] = createItemESPDrawing(instance)
        end
        itemEspDrawingObjects[instance].Visible = true
        itemEspDrawingObjects[instance].Position = UDim2.new(0, screenPoint.X, 0, screenPoint.Y)
        itemEspDrawingObjects[instance].Text = instance.Name .. " (" .. math.floor((Player.Character.HumanoidRootPart.Position - instance.Position).Magnitude) .. "m)"
    else
        if itemEspDrawingObjects[instance] then
            itemEspDrawingObjects[instance].Visible = false
        end
    end
end

local function disableItemESP()
    for inst, drawing in pairs(itemEspDrawingObjects) do
        drawing:Destroy()
    end
    itemEspDrawingObjects = {}
    for _, conn in pairs(itemEspConnections) do
        conn:Disconnect()
    end
    itemEspConnections = {}
end

local function enableItemESP()
    for _, instance in ipairs(Workspace:GetDescendants()) do
        if instance:IsA("BasePart") and instance.Name:lower():find("collectible") or instance.Name:lower():find("item") or instance:IsA("Model") and instance:FindFirstChildOfClass("Humanoid") then -- Basic filter
            updateItemESP(instance)
        end
    end
    itemEspConnections["descendantAdded"] = Workspace.DescendantAdded:Connect(function(descendant)
        if descendant:IsA("BasePart") and descendant.Name:lower():find("collectible") or descendant.Name:lower():find("item") or descendant:IsA("Model") and descendant:FindFirstChildOfClass("Humanoid") then
            updateItemESP(descendant)
        end
    end)
    itemEspConnections["renderStepped"] = RunService.RenderStepped:Connect(function()
        for _, instance in pairs(itemEspDrawingObjects) do
            updateItemESP(instance.Parent.Adornee) -- Assuming Adornee is the actual instance
        end
    end)
end

createToggle(MainTabContent, "Item ESP", function(active)
    itemEspEnabled = active
    if active then
        enableItemESP()
    else
        disableItemESP()
    end
end)

-- 16. Tracers (From player to targets, toggle) - Already part of ESP

-- 17. Chams (Highlight players through walls, color options).
-- Chams typically require shaders or advanced rendering techniques not directly exposed in Luau.
-- A simplified version could involve making parts semi-transparent or changing their color.
local chamsEnabled = false
local chamsColor = Color3.fromRGB(255, 0, 255) -- Magenta
local chamsConnection = nil

local function doChams(character)
    if not character or character == Player.Character then return end
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Color = chamsColor
            part.Transparency = 0.5
        end
    end
end

local function disableChamsForCharacter(character)
    if not character or character == Player.Character then return end
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            -- Reset to original color/transparency (difficult to track without storing original values)
            -- For simplicity, we'll just make them fully opaque and default color.
            part.Color = Color3.fromRGB(192, 192, 192) -- A common default part color
            part.Transparency = 0
        end
    end
end

createToggle(MainTabContent, "Chams", function(active)
    chamsEnabled = active
    if active then
        for _, p in ipairs(Players:GetPlayers()) do
            if p.Character then
                doChams(p.Character)
            end
        end
        chamsConnection = Players.PlayerAdded:Connect(function(p)
            p.CharacterAdded:Connect(function(char)
                doChams(char)
            end)
        end)
    else
        if chamsConnection then
            chamsConnection:Disconnect()
            chamsConnection = nil
        end
        for _, p in ipairs(Players:GetPlayers()) do
            if p.Character then
                disableChamsForCharacter(p.Character)
            end
        end
    end
end)

-- 18. No Recoil (Toggle for weapons).
local noRecoilEnabled = false
local noRecoilConnection = nil

local function doNoRecoil()
    local camera = Workspace.CurrentCamera
    if camera then
        camera.CFrame = CFrame.new(camera.CFrame.p, camera.CFrame.p + camera.CFrame.LookVector) -- Resets camera orientation
    end
end

createToggle(MainTabContent, "No Recoil", function(active)
    noRecoilEnabled = active
    if active then
        noRecoilConnection = RunService.RenderStepped:Connect(doNoRecoil)
    else
        if noRecoilConnection then
            noRecoilConnection:Disconnect()
            noRecoilConnection = nil
        end
    end
end)

-- 19. No Spread (Toggle).
-- No Spread is highly dependent on how weapons are implemented. Client-side changes are often ignored.
createToggle(MainTabContent, "No Spread (Game Dependent)", function(active)
    warn("No Spread functionality is highly dependent on the game's server-side logic.")
end)

-- 20. Infinite Ammo (Toggle).
-- Infinite Ammo is highly game-dependent and often server-sided.
createToggle(MainTabContent, "Infinite Ammo (Game Dependent)", function(active)
    warn("Infinite Ammo functionality is highly dependent on the game's server-side logic.")
end)

-- 21. Rapid Fire (Toggle, rate via textbox).
local rapidFireEnabled = false
local rapidFireRate = 0.1 -- seconds between shots
local rapidFireConnection = nil

local function doRapidFire()
    if rapidFireEnabled then
        UserInputService:SimulateMouseClick(Enum.UserInputType.MouseButton1)
    end
end

createToggle(MainTabContent, "Rapid Fire", function(active)
    rapidFireEnabled = active
    if active then
        rapidFireConnection = RunService.Heartbeat:Connect(function()
            task.wait(rapidFireRate)
            doRapidFire()
        end)
    else
        if rapidFireConnection then
            rapidFireConnection:Disconnect()
            rapidFireConnection = nil
        end
    end
end)

createTextbox(MainTabContent, "Rapid Fire Rate (s)", rapidFireRate, function(value)
    rapidFireRate = tonumber(value) or rapidFireRate
end)

-- 22. Bunny Hop (Toggle for auto-jump speed).
local bunnyHopEnabled = false
local bunnyHopConnection = nil

local function doBunnyHop()
    local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid and humanoid.FloorMaterial ~= Enum.Material.Air then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end

createToggle(MainTabContent, "Bunny Hop", function(active)
    bunnyHopEnabled = active
    if active then
        bunnyHopConnection = RunService.Heartbeat:Connect(doBunnyHop)
    else
        if bunnyHopConnection then
            bunnyHopConnection:Disconnect()
            bunnyHopConnection = nil
        end
    end
end)

-- 23. Auto Respawn (Toggle).
local autoRespawnEnabled = false
local autoRespawnConnection = nil

local function doAutoRespawn()
    if Player.Character and Player.Character:FindFirstChildOfClass("Humanoid") and Player.Character:FindFirstChildOfClass("Humanoid").Health <= 0 then
        Player:LoadCharacter()
    end
end

createToggle(MainTabContent, "Auto Respawn", function(active)
    autoRespawnEnabled = active
    if active then
        autoRespawnConnection = Player.CharacterAdded:Connect(function(char)
            char:WaitForChild("Humanoid").Died:Connect(function()
                if autoRespawnEnabled then
                    task.wait(1) -- Wait a bit before respawning
                    Player:LoadCharacter()
                end
            end)
        end)
    else
        if autoRespawnConnection then
            autoRespawnConnection:Disconnect()
            autoRespawnConnection = nil
        end
    end
end)

-- 24. Player List (Show all players with TP/kick buttons if possible).
local playerListContent = Instance.new("ScrollingFrame")
playerListContent.Size = UDim2.new(1, -20, 0, 200) -- Example size
playerListContent.Position = UDim2.new(0, 10, 0, 0)
playerListContent.BackgroundColor3 = Config.Theme.Background
playerListContent.BorderSizePixel = 1
playerListContent.BorderColor3 = Config.Theme.Accent
playerListContent.Parent = MainTabContent

local playerListLayout = Instance.new("UIListLayout")
playerListLayout.FillDirection = Enum.FillDirection.Vertical
playerListLayout.Padding = UDim.new(0, 2)
playerListLayout.Parent = playerListContent

local function updatePlayerList()
    for _, child in ipairs(playerListContent:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end

    for _, p in ipairs(Players:GetPlayers()) do
        local playerFrame = Instance.new("Frame")
        playerFrame.Size = UDim2.new(1, 0, 0, 25)
        playerFrame.BackgroundColor3 = Config.Theme.Accent
        playerFrame.BorderSizePixel = 0
        playerFrame.Parent = playerListContent

        local playerNameLabel = Instance.new("TextLabel")
        playerNameLabel.Size = UDim2.new(0.6, 0, 1, 0)
        playerNameLabel.BackgroundColor3 = Config.Theme.Accent
        playerNameLabel.BackgroundTransparency = 1
        playerNameLabel.Text = p.Name
        playerNameLabel.TextColor3 = Config.Theme.Text
        playerNameLabel.Font = Enum.Font.SourceSansSemibold
        playerNameLabel.TextSize = 14
        playerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
        playerNameLabel.Parent = playerFrame

        local tpButton = Instance.new("TextButton")
        tpButton.Size = UDim2.new(0.2, 0, 1, 0)
        tpButton.Position = UDim2.new(0.6, 0, 0, 0)
        tpButton.BackgroundColor3 = Config.Theme.Primary
        tpButton.BorderSizePixel = 0
        tpButton.Text = "TP"
        tpButton.TextColor3 = Config.Theme.Text
        tpButton.Font = Enum.Font.SourceSansBold
        tpButton.TextSize = 12
        tpButton.Parent = playerFrame
        tpButton.MouseButton1Click:Connect(function()
            teleportToPlayer(p.Name)
        end)

        -- Kick button is generally server-sided and not possible client-side
        -- local kickButton = Instance.new(
TextButton")
        kickButton.Size = UDim2.new(0.2, 0, 1, 0)
        kickButton.Position = UDim2.new(0.8, 0, 0, 0)
        kickButton.BackgroundColor3 = Config.Theme.Accent
        kickButton.BorderSizePixel = 0
        kickButton.Text = "Kick"
        kickButton.TextColor3 = Config.Theme.Text
        kickButton.Font = Enum.Font.SourceSansBold
        kickButton.TextSize = 12
        kickButton.Parent = playerFrame
        kickButton.MouseButton1Click:Connect(function()
            warn("Client-sided kick is not possible.")
        end)
    end
end

createButton(MainTabContent, "Refresh Player List", updatePlayerList)
updatePlayerList() -- Initial population

-- 25. Server Hopper
createButton(MainTabContent, "Server Hop", function()
    local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. tostring(game.PlaceId) .. "/servers/Public?sortOrder=Asc&limit=100"))
    if servers and servers.data then
        for _, server in ipairs(servers.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, server.id)
                return
            end
        end
    end
    warn("No available servers found to hop to.")
end)

-- 26. Anti-AFK
local antiAfkEnabled = false
local antiAfkConnection = nil

createToggle(MainTabContent, "Anti-AFK", function(active)
    antiAfkEnabled = active
    if active then
        antiAfkConnection = RunService.Heartbeat:Connect(function()
            if Player.Idled then
                Player.Idled:fire()
            end
        end)
    else
        if antiAfkConnection then
            antiAfkConnection:Disconnect()
            antiAfkConnection = nil
        end
    end
end)

-- 27. Unlock All (Game Dependent)
createToggle(MainTabContent, "Unlock All (Game Dependent)", function(active)
    warn("Unlock All functionality is highly dependent on the game's server-side logic.")
end)

-- 28. Custom Script Injector (Mini executor in tab for quick codes) - This is the Executor Tab

-- 29. Auto Farm (Basic mob/target farm if applicable)
local autoFarmEnabled = false
local autoFarmConnection = nil

local function doAutoFarm()
    -- This is a very basic auto-farm. It finds the nearest NPC and attacks it.
    local closestNpc = nil
    local minDistance = math.huge
    local localPlayerRoot = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not localPlayerRoot then return end

    for _, entity in ipairs(Workspace:GetDescendants()) do
        if entity:IsA("Model") and entity:FindFirstChildOfClass("Humanoid") and entity ~= Player.Character and entity:FindFirstChild("HumanoidRootPart") then
            local distance = (localPlayerRoot.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < minDistance then
                minDistance = distance
                closestNpc = entity
            end
        end
    end

    if closestNpc then
        local tool = Player.Character:FindFirstChildOfClass("Tool")
        if tool and tool:FindFirstChild("Handle") then
            Player.Character.Humanoid:EquipTool(tool)
            tool:Activate()
        end
    end
end

createToggle(MainTabContent, "Auto Farm (Basic)", function(active)
    autoFarmEnabled = active
    if active then
        autoFarmConnection = RunService.Heartbeat:Connect(doAutoFarm)
    else
        if autoFarmConnection then
            autoFarmConnection:Disconnect()
            autoFarmConnection = nil
        end
    end
end)


--[[ Hub Tab ]]
local HubTabContent = createTab("Hub", Instance.new("ScrollingFrame"))
local HubTabFeaturesLayout = Instance.new("UIListLayout")
HubTabFeaturesLayout.FillDirection = Enum.FillDirection.Vertical
HubTabFeaturesLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
HubTabFeaturesLayout.VerticalAlignment = Enum.VerticalAlignment.Top
HubTabFeaturesLayout.Padding = UDim.new(0, 5)
HubTabFeaturesLayout.Parent = HubTabContent

local function createHubButton(parent, name, loadstringCode, keyStatus)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 30)
    button.Position = UDim2.new(0, 10, 0, 0)
    button.BackgroundColor3 = Config.Theme.Accent
    button.BorderSizePixel = 1
    button.BorderColor3 = Config.Theme.ButtonBorder
    button.Text = name .. " - " .. keyStatus
    button.TextColor3 = Config.Theme.Text
    button.Font = Enum.Font.SourceSansSemibold
    button.TextSize = 14
    button.TextXAlignment = Enum.TextXAlignment.Left
    button.Parent = parent

    button.MouseButton1Click:Connect(function()
        local success, err = pcall(function()
            loadstring(game:HttpGet(loadstringCode))()
        end)
        if not success then
            warn("Error executing hub script: " .. err)
        end
    end)
    return button
end

-- Blox Fruits Hubs
createSection(HubTabContent, "Blox Fruits Hubs")
createHubButton(HubTabContent, "Speed Hub X", "https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", "KEYLESS")
createHubButton(HubTabContent, "Annie Hub by Mars", "https://raw.githubusercontent.com/1st-Mars/Annie/main/1st.lua", "KEYLESS")
createHubButton(HubTabContent, "Monster Hub", "https://raw.githubusercontent.com/giahuy2511-coder/MonsterHub/refs/heads/main/MonsterHub", "KEYLESS")
createHubButton(HubTabContent, "ThanHub Freemium", "https://raw.githubusercontent.com/thantzy/thanhub/refs/heads/main/thanv1", "HAS KEY")
createHubButton(HubTabContent, "Aurora Hub", "https://raw.githubusercontent.com/Jadelly261/BloxFruits/main/Aurora", "HAS KEY")
createHubButton(HubTabContent, "Alchemy Hub", "https://scripts.alchemyhub.xyz", "HAS KEY")
createHubButton(HubTabContent, "Banana Cat Hub", "https://raw.githubusercontent.com/obiiyeuem/vthangsitink/main/BananaHub.lua", "HAS KEY")
createHubButton(HubTabContent, "Thunderz Hub", "https://raw.githubusercontent.com/ThunderZ-05/HUB/main/Script", "HAS KEY")
createHubButton(HubTabContent, "Astro Hub", "https://raw.githubusercontent.com/astrohub1/Perm-Spawner/refs/heads/main/BloxFruits.lua", "HAS KEY")
createHubButton(HubTabContent, "StarStream Hub", "https://raw.githubusercontent.com/starstreamowner/StarStream/refs/heads/main/Hub", "HAS KEY")
createHubButton(HubTabContent, "Johnny Cheese Hub", "https://raw.githubusercontent.com/JonnyCheeser/bloxfruits/main/minhubv4", "HAS KEY")
createHubButton(HubTabContent, "Hoho Hub", "https://raw.githubusercontent.com/acsu123/HOHO_H/main/Loading_UI", "HAS KEY")
createHubButton(HubTabContent, "Mukuro Hub", "https://raw.githubusercontent.com/xQuartyx/QuartyzScript/main/Loader.lua", "HAS KEY")
createHubButton(HubTabContent, "Neru Hub", "https://raw.githubusercontent.com/NeroHubClub/AutoMythicFruitFinder/refs/heads/main/NeroHubFruitFinder", "UNKNOWN")
createHubButton(HubTabContent, "Redz Hub", "https://raw.githubusercontent.com/tlredz/Scripts/refs/heads/main/main.luau", "KEYLESS")
createHubButton(HubTabContent, "Teddy Hub", "https://raw.githubusercontent.com/Teddyseetink/Haidepzai/refs/heads/main/TeddyHub.lua", "UNKNOWN")
createHubButton(HubTabContent, "Delta Hub", "https://raw.githubusercontent.com/Efe0626/RaitoHub/main/Script", "UNKNOWN")
createHubButton(HubTabContent, "Banana Hub", "https://raw.githubusercontent.com/Nghia11n/Banana-Hub/main/bananahub.lua", "UNKNOWN")
createHubButton(HubTabContent, "BlueX Hub Auto Farm", "https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua", "UNKNOWN")
createHubButton(HubTabContent, "Redz Hub Classic", "https://raw.githubusercontent.com/realredz/BloxFruits/refs/heads/main/Source.lua", "KEYLESS")
createHubButton(HubTabContent, "QuantumOnyx", "https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua", "KEYLESS")
createHubButton(HubTabContent, "Maru x Hub", "https://raw.githubusercontent.com/NinoGod/Free-Script/main/Maru-x-Hub-Free.lua", "UNKNOWN")
createHubButton(HubTabContent, "Dat Thg Hub V2", "https://raw.githubusercontent.com/LuaCrack/DatThg/refs/heads/main/DatThgV2", "UNKNOWN")

-- Redz Hub Variants
createSection(HubTabContent, "Redz Hub Variants")
createHubButton(HubTabContent, "Redz Hub Blox Fruits", "https://raw.githubusercontent.com/newredz/BloxFruits/refs/heads/main/Source.luau", "KEYLESS")
createHubButton(HubTabContent, "Redz Hub Blox Fruits (Pirates)", "https://raw.githubusercontent.com/newredz/BloxFruits/refs/heads/main/Source.luau", "KEYLESS") -- Note: Settings need to be passed, which is complex for this setup
createHubButton(HubTabContent, "Redz Hub Blox Fruits Pastefy", "https://pastefy.app/ACOX6D6h/raw", "KEYLESS")
createHubButton(HubTabContent, "REDzHUB Blox Fruits", "https://raw.githubusercontent.com/REDzHUB/BloxFruits/main/redz9999", "KEYLESS")
createHubButton(HubTabContent, "Redz Hub Meme Sea", "https://raw.githubusercontent.com/realredz/MemeSea/refs/heads/main/Source.lua", "KEYLESS")
createHubButton(HubTabContent, "Redz Hub Blade Ball", "https://raw.githubusercontent.com/REDzHUB/BladeBall/main/redz9999", "KEYLESS")
createHubButton(HubTabContent, "Redz Hub Pet Simulator 99", "https://raw.githubusercontent.com/REDzHUB/PetSimulator99/main/redz9999.lua", "KEYLESS")

-- Other Keyless/Devs Hubs
createSection(HubTabContent, "Other Keyless/Devs Hubs")
createHubButton(HubTabContent, "MM2 Autofarm", "https://meowrobux.vercel.app/raw/capybara.lua", "KEYLESS")
createHubButton(HubTabContent, "Hiru Hub Free (Blox Fruits)", "https://raw.githubusercontent.com/HiruKiddo/Source/main/HiruHubFree.lua", "KEYLESS")
createHubButton(HubTabContent, "Gravity Hub Blox Fruits", "https://raw.githubusercontent.com/Dev-GravityHub/BloxFruit/refs/heads/main/Main.lua", "KEYLESS")
createHubButton(HubTabContent, "Drakthon Hub MM2", "https://raw.githubusercontent.com/fisal-new/Only/refs/heads/main/drakmm.txt", "KEYLESS")
createHubButton(HubTabContent, "Lejax Moreira Auto", "https://raw.githubusercontent.com/lejax7xmoreira/script/refs/heads/main/script.lua", "HAS KEY")
createHubButton(HubTabContent, "Brainrot Duping", "https://pastebin.com/raw/wjF7iJQf", "KEYLESS")
createHubButton(HubTabContent, "Plants vs Brainrot", "https://pastefy.app/RhJOfwwO/raw", "KEYLESS")
createHubButton(HubTabContent, "Teleport Script", "https://pastebin.com/raw/rPwTabeM", "KEYLESS")
createHubButton(HubTabContent, "H4x Loader", "https://raw.githubusercontent.com/H4xScripts/Loader/refs/heads/main/loader.lua", "KEYLESS")
createHubButton(HubTabContent, "Multi Hub", "https://raw.githubusercontent.com/randomaccnt91-coder/BEST-MM2-ADOPT-ME-GAG-PVB-SABSCRIPT/refs/heads/main/BEST.lua", "KEYLESS")
createHubButton(HubTabContent, "The Forge Hub", "https://api.luarmor.net/files/v3/loaders/280c3c5ae0ed18010fea0d86c424fdb5.lua", "KEYLESS")
createHubButton(HubTabContent, "Parvus Shooter Hub", "https://raw.githubusercontent.com/AlexR32/Parvus/main/Loader.lua", "KEYLESS")
createHubButton(HubTabContent, "Owl Hub Classic", "https://raw.githubusercontent.com/CriShoux/OwlHub/master/OwlHub.txt", "KEYLESS")

--[[ Executor Tab ]]
local ExecutorTabContent = createTab("Executor", Instance.new("Frame"))
local executorTextbox = Instance.new("TextBox")
executorTextbox.Size = UDim2.new(1, -20, 1, -50)
executorTextbox.Position = UDim2.new(0, 10, 0, 10)
executorTextbox.BackgroundColor3 = Config.Theme.Accent
executorTextbox.BorderSizePixel = 1
executorTextbox.BorderColor3 = Config.Theme.ButtonBorder
executorTextbox.Text = "-- Paste your script here"
executorTextbox.TextColor3 = Config.Theme.Text
executorTextbox.Font = Enum.Font.Code
executorTextbox.TextSize = 14
executorTextbox.TextXAlignment = Enum.TextXAlignment.Left
executorTextbox.TextYAlignment = Enum.TextYAlignment.Top
executorTextbox.MultiLine = true
executorTextbox.ClearTextOnFocus = false
executorTextbox.Parent = ExecutorTabContent

local executeButton = Instance.new("TextButton")
executeButton.Size = UDim2.new(1, -20, 0, 30)
executeButton.Position = UDim2.new(0, 10, 1, -40)
executeButton.BackgroundColor3 = Config.Theme.Primary
executeButton.BorderSizePixel = 1
executeButton.BorderColor3 = Config.Theme.ButtonBorder
executeButton.Text = "Execute"
executeButton.TextColor3 = Config.Theme.Text
executeButton.Font = Enum.Font.SourceSansBold
executeButton.TextSize = 16
executeButton.Parent = ExecutorTabContent

executeButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(executorTextbox.Text)()
    end)
    if not success then
        warn("Execution Error: " .. err)
    end
end)

--[[ Settings Tab ]]
local SettingsTabContent = createTab("Settings", Instance.new("ScrollingFrame"))
local SettingsTabFeaturesLayout = Instance.new("UIListLayout")
SettingsTabFeaturesLayout.FillDirection = Enum.FillDirection.Vertical
SettingsTabFeaturesLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
SettingsTabFeaturesLayout.VerticalAlignment = Enum.VerticalAlignment.Top
SettingsTabFeaturesLayout.Padding = UDim.new(0, 5)
SettingsTabFeaturesLayout.Parent = SettingsTabContent

createSection(SettingsTabContent, "Keybinds")

local toggleKeybind = Enum.KeyCode.RightControl
local minimizeKeybind = Enum.KeyCode.RightShift

createTextbox(SettingsTabContent, "Toggle GUI Keybind", toggleKeybind.Name, function(value)
    if Enum.KeyCode[value] then
        toggleKeybind = Enum.KeyCode[value]
    end
end)

createTextbox(SettingsTabContent, "Minimize GUI Keybind", minimizeKeybind.Name, function(value)
    if Enum.KeyCode[value] then
        minimizeKeybind = Enum.KeyCode[value]
    end
end)

createSection(SettingsTabContent, "Performance")

local espUpdateRate = 0.1
createTextbox(SettingsTabContent, "ESP Update Rate (s)", espUpdateRate, function(value)
    espUpdateRate = tonumber(value) or espUpdateRate
    -- Note: This requires refactoring the ESP loop to use this value, which is not done in this version for simplicity.
end)

--[[ Final Setup ]]
-- Activate the first tab
if TabButtons["Main"] then
    TabButtons["Main"].MouseButton1Click:Fire()
end

-- Keybind listeners
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if not gameProcessedEvent then
        if input.KeyCode == toggleKeybind then
            toggleFullGUI()
        elseif input.KeyCode == minimizeKeybind then
            toggleMinimize()
        end
    end
end)

print("Exploit Hub GUI Loaded!")
